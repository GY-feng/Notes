# Week 14 Minimum Spanning Trees

**ç”Ÿæˆæ ‘**ï¼šä¸€ä¸ªæ— å‘å›¾ \( G \) çš„ç”Ÿæˆæ ‘ \( T \) æ˜¯å…¶å­å›¾ï¼Œä¸” \( T \) æ˜¯ä¸€æ£µåŒ…å«å›¾ \( G \) ä¸­æ‰€æœ‰é¡¶ç‚¹çš„æ ‘ã€‚

**æœ€å°ç”Ÿæˆæ ‘**ï¼šä¸€æ£µç”Ÿæˆæ ‘ï¼Œå…¶æ€»è¾¹æƒé‡æœ€å°ã€‚

![alt text](image.png)

![alt text](image-1.png)


## Primâ€™s Algorithm

![alt text](image-2.png)

![alt text](image-3.png)

ä»£ç å®ç°ï¼š
```python
import heapq

def prim(graph, start):
    # å›¾çš„è¡¨ç¤ºä¸ºé‚»æ¥è¡¨
    # graph = {v: [(neighbor1, weight1), (neighbor2, weight2), ...]}
    
    # åˆå§‹åŒ–æ•°æ®ç»“æ„
    T = {}  # T(v, parent): æœ€å°ç”Ÿæˆæ ‘ï¼Œå­˜å‚¨æ ‘ä¸­çš„è¾¹
    D = {start: 0}  # D[v]: ä»æ ‘åˆ°é¡¶ç‚¹ v çš„æœ€çŸ­è·ç¦»ï¼Œèµ·å§‹é¡¶ç‚¹çš„è·ç¦»ä¸º 0
    Q = []  # ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œå­˜å‚¨ (è·ç¦», é¡¶ç‚¹) å¯¹
    for vertex in graph:
        if vertex != start:
            D[vertex] = float('inf')  # å…¶ä»–é¡¶ç‚¹çš„åˆå§‹è·ç¦»è®¾ä¸ºæ— ç©·å¤§
        heapq.heappush(Q, (D[vertex], vertex))  # å°†æ‰€æœ‰é¡¶ç‚¹åŠå…¶åˆå§‹è·ç¦»æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—
    
    while Q:
        # ä»é˜Ÿåˆ—ä¸­å–å‡ºè·ç¦»æœ€å°çš„é¡¶ç‚¹
        dist, u = heapq.heappop(Q)
        
        # å¦‚æœè·ç¦»ä¸ºæ— ç©·å¤§ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šé¡¶ç‚¹å¯ä»¥åŠ å…¥æ ‘ä¸­äº†
        if dist == float('inf'):
            break

        # å°†é¡¶ç‚¹ u æ·»åŠ åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­
        if u not in T:
            T[u] = None  # åˆå§‹æ—¶æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œè¡¨ç¤ºå°†é¡¶ç‚¹ u æ·»åŠ åˆ°æ ‘ä¸­
        
        # æ›´æ–°ä¸é¡¶ç‚¹ u ç›¸é‚»çš„é¡¶ç‚¹çš„æœ€çŸ­è·ç¦»
        for v, weight in graph[u]:
            if v in D and v in Q and weight < D[v]:
                # å¦‚æœæ‰¾åˆ°æ›´çŸ­çš„è·ç¦»ï¼Œæ›´æ–° D[v]
                D[v] = weight
                heapq.heappush(Q, (weight, v))  # å°†æ›´æ–°åçš„é¡¶ç‚¹é‡æ–°åŠ å…¥é˜Ÿåˆ—
                T[v] = (u, weight)  # æ›´æ–°é¡¶ç‚¹ v çš„çˆ¶èŠ‚ç‚¹å’Œè¿æ¥å®ƒçš„è¾¹çš„æƒé‡

    return T

# ç¤ºä¾‹å›¾ï¼š
graph = {
    'A': [('B', 1), ('C', 3), ('D', 4)],  # A é¡¶ç‚¹çš„é‚»æ¥é¡¶ç‚¹å’Œè¾¹çš„æƒé‡
    'B': [('A', 1), ('C', 2), ('D', 5)],  # B é¡¶ç‚¹çš„é‚»æ¥é¡¶ç‚¹å’Œè¾¹çš„æƒé‡
    'C': [('A', 3), ('B', 2), ('D', 1)],  # C é¡¶ç‚¹çš„é‚»æ¥é¡¶ç‚¹å’Œè¾¹çš„æƒé‡
    'D': [('A', 4), ('B', 5), ('C', 1)]   # D é¡¶ç‚¹çš„é‚»æ¥é¡¶ç‚¹å’Œè¾¹çš„æƒé‡
}

start = 'A'  # èµ·å§‹é¡¶ç‚¹
mst = prim(graph, start)

# è¾“å‡ºæœ€å°ç”Ÿæˆæ ‘
print("æœ€å°ç”Ÿæˆæ ‘ (MST):")
for vertex, (parent, weight) in mst.items():
    if parent:
        print(f"{parent} - {vertex} (æƒé‡: {weight})")

'''
ä»£ç è§£é‡Šï¼š
å›¾çš„è¡¨ç¤ºï¼š

å›¾ä½¿ç”¨é‚»æ¥è¡¨è¡¨ç¤ºï¼Œå…¶ä¸­æ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œè¡¨ç¤ºä¸€ä¸ªé‚»æ¥é¡¶ç‚¹åŠå…¶è¾¹çš„æƒé‡ã€‚
æ•°æ®ç»“æ„ï¼š

T: ç”¨äºå­˜å‚¨æœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰ï¼Œå­—å…¸ä¸­æ¯ä¸ªé”®è¡¨ç¤ºä¸€ä¸ªé¡¶ç‚¹ï¼Œå€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œè¡¨ç¤ºè¯¥é¡¶ç‚¹çš„çˆ¶èŠ‚ç‚¹å’Œè¾¹çš„æƒé‡ã€‚
D: å­˜å‚¨ä»æ ‘ä¸­å·²åŒ…å«çš„é¡¶ç‚¹åˆ°å…¶ä»–é¡¶ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå­—å…¸ä¸­çš„æ¯ä¸ªé”®æ˜¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œå€¼æ˜¯è¯¥é¡¶ç‚¹åˆ°æœ€å°ç”Ÿæˆæ ‘çš„æœ€çŸ­è·ç¦»ã€‚
Q: ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œç”¨äºæ¯æ¬¡é€‰æ‹©è·ç¦»æœ€çŸ­çš„é¡¶ç‚¹ã€‚å­˜å‚¨çš„æ˜¯ä¸€ä¸ªå…ƒç»„ (è·ç¦», é¡¶ç‚¹)ã€‚
ç®—æ³•æ­¥éª¤ï¼š

åˆå§‹åŒ–æ—¶ï¼Œå°†æ‰€æœ‰é¡¶ç‚¹çš„è·ç¦»è®¾ç½®ä¸ºæ— ç©·å¤§ï¼Œèµ·å§‹é¡¶ç‚¹çš„è·ç¦»ä¸º 0ï¼Œå¹¶å°†æ‰€æœ‰é¡¶ç‚¹åŠå…¶åˆå§‹è·ç¦»æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚
æ¯æ¬¡ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–å‡ºè·ç¦»æœ€å°çš„é¡¶ç‚¹ uï¼Œå¦‚æœ u æ²¡æœ‰è¢«åŠ å…¥åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­ï¼Œåˆ™å°†å…¶åŠ å…¥ã€‚
ç„¶åæ£€æŸ¥ u çš„é‚»æ¥é¡¶ç‚¹ vï¼Œå¦‚æœé€šè¿‡ u åˆ° v çš„è¾¹å¯ä»¥æ›´æ–° v çš„æœ€çŸ­è·ç¦»ï¼Œå°±æ›´æ–°è·ç¦»å¹¶å°† v é‡æ–°åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚
æœ€ç»ˆè¿”å›çš„ T åŒ…å«äº†æœ€å°ç”Ÿæˆæ ‘çš„æ‰€æœ‰é¡¶ç‚¹åŠå…¶å¯¹åº”çš„çˆ¶èŠ‚ç‚¹å’Œè¿æ¥è¾¹çš„æƒé‡ã€‚
è¿”å›ç»“æœï¼š

T è¿”å›çš„æ˜¯æœ€å°ç”Ÿæˆæ ‘çš„è¾¹å’Œæƒé‡ï¼Œè¡¨ç¤ºå›¾ä¸­å„ä¸ªé¡¶ç‚¹ä¸æ ‘ä¸­çš„çˆ¶èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å’Œè¾¹çš„æƒé‡ã€‚
ç¤ºä¾‹è¾“å‡ºï¼š
å¯¹äºä¸Šè¿°ç¤ºä¾‹ï¼Œè¾“å‡ºçš„æœ€å°ç”Ÿæˆæ ‘å¯èƒ½æ˜¯ï¼š

æœ€å°ç”Ÿæˆæ ‘ (MST):
A - B (æƒé‡: 1)
B - C (æƒé‡: 2)
C - D (æƒé‡: 1)
è¿™è¡¨ç¤ºä»é¡¶ç‚¹ A å‡ºå‘ï¼Œæœ€å°ç”Ÿæˆæ ‘åŒ…å«è¾¹ A-Bã€B-C å’Œ C-Dï¼Œå®ƒä»¬çš„æƒé‡åˆ†åˆ«ä¸º 1ã€2 å’Œ 1ã€‚
'''
```
æ—¶é—´å¤æ‚åº¦ï¼š
ä½¿ç”¨åŸºäºå †çš„ä¼˜å…ˆé˜Ÿåˆ—æ—¶ï¼Œæ¯ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ ğ‘‚(log ğ‘›)ï¼Œå› æ­¤ç®—æ³•çš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º ğ‘‚(ğ‘› + ğ‘š log ğ‘›)ï¼Œå¯¹äºä¸€ä¸ªè¿é€šå›¾æ¥è¯´ï¼Œè¿™ä¸ªå¤æ‚åº¦ç®€åŒ–ä¸º ğ‘‚(ğ‘š log ğ‘›)ã€‚

å¦å¤–ï¼Œå¦‚æœä½¿ç”¨æœªæ’åºçš„åˆ—è¡¨ä½œä¸ºä¼˜å…ˆé˜Ÿåˆ—ï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ° ğ‘‚(ğ‘›Â²)ã€‚

## Kruskalâ€™s Algorithm
ä½¿ç”¨è¿™ä¸ªç®—æ³•æœ€å¥½çš„

![alt text](image-4.png)

![alt text](image-5.png)

```python

class UnionFind:
    def __init__(self, n):
        # åˆå§‹åŒ–çˆ¶èŠ‚ç‚¹æ•°ç»„ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹åˆå§‹åŒ–ä¸ºè‡ªå·±
        self.parent = list(range(n))
        # åˆå§‹åŒ–æ¯ä¸ªèŠ‚ç‚¹çš„ç§©ï¼ˆæ ‘çš„é«˜åº¦ï¼‰
        self.rank = [0] * n

    def find(self, x):
        # è·¯å¾„å‹ç¼©ï¼Œä¼˜åŒ–æŸ¥æ‰¾è¿‡ç¨‹
        if self.parent[x] != x:
            self.parent[x] = self.find(self.parent[x])
        return self.parent[x]

    def union(self, x, y):
        # æ‰¾åˆ° x å’Œ y çš„æ ¹èŠ‚ç‚¹
        rootX = self.find(x)
        rootY = self.find(y)
        
        # å¦‚æœæ ¹èŠ‚ç‚¹ä¸åŒï¼Œè¯´æ˜å®ƒä»¬å±äºä¸åŒçš„é›†åˆï¼Œå¯ä»¥åˆå¹¶
        if rootX != rootY:
            # ä½¿ç”¨ç§©æ¥ä¼˜åŒ–åˆå¹¶è¿‡ç¨‹ï¼Œç§©å°çš„æ ‘åˆå¹¶åˆ°ç§©å¤§çš„æ ‘ä¸Š
            if self.rank[rootX] > self.rank[rootY]:
                self.parent[rootY] = rootX
            elif self.rank[rootX] < self.rank[rootY]:
                self.parent[rootX] = rootY
            else:
                self.parent[rootY] = rootX
                self.rank[rootX] += 1
            return True
        return False

def kruskal(n, edges):
    # n: å›¾çš„é¡¶ç‚¹æ•°ï¼Œedges: è¾¹çš„åˆ—è¡¨ï¼Œæ ¼å¼ä¸º (æƒé‡, èµ·ç‚¹, ç»ˆç‚¹)
    
    # 1. æŒ‰ç…§è¾¹çš„æƒé‡æ’åº
    edges.sort()
    
    uf = UnionFind(n)
    mst = []  # æœ€å°ç”Ÿæˆæ ‘
    total_weight = 0  # æœ€å°ç”Ÿæˆæ ‘çš„æ€»æƒé‡

    # 2. éå†æ‰€æœ‰è¾¹
    for weight, u, v in edges:
        # 3. å¦‚æœå½“å‰è¾¹è¿æ¥çš„æ˜¯ä¸åŒçš„å­é›†ï¼ˆå³ä¸ä¼šå½¢æˆç¯ï¼‰ï¼Œåˆ™å°†è¯¥è¾¹åŠ å…¥æœ€å°ç”Ÿæˆæ ‘
        if uf.union(u, v):
            mst.append((u, v, weight))
            total_weight += weight
    
    return mst, total_weight

# æµ‹è¯•ä¾‹å­
if __name__ == "__main__":
    # å›¾çš„é¡¶ç‚¹æ•°
    n = 4
    # å›¾çš„è¾¹ï¼Œæ ¼å¼ä¸º (æƒé‡, èµ·ç‚¹, ç»ˆç‚¹)
    edges = [
        (1, 0, 1),  # è¾¹ (0, 1) æƒé‡ 1
        (3, 0, 2),  # è¾¹ (0, 2) æƒé‡ 3
        (2, 1, 2),  # è¾¹ (1, 2) æƒé‡ 2
        (4, 1, 3),  # è¾¹ (1, 3) æƒé‡ 4
        (5, 2, 3),  # è¾¹ (2, 3) æƒé‡ 5
    ]

    mst, total_weight = kruskal(n, edges)
    
    print("æœ€å°ç”Ÿæˆæ ‘çš„è¾¹:", mst)
    print("æœ€å°ç”Ÿæˆæ ‘çš„æ€»æƒé‡:", total_weight)


'''
ä»£ç è§£é‡Š
UnionFind ç±»ï¼š

è¿™ä¸ªç±»å®ç°äº†å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰æ•°æ®ç»“æ„ï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸»è¦æ“ä½œï¼š
find(x)ï¼šæŸ¥æ‰¾èŠ‚ç‚¹ x çš„æ ¹èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œè·¯å¾„å‹ç¼©ï¼Œä¼˜åŒ–æŸ¥æ‰¾æ•ˆç‡ã€‚
union(x, y)ï¼šå°†ä¸¤ä¸ªä¸åŒçš„å­é›†åˆå¹¶ï¼Œå¦‚æœ x å’Œ y å±äºä¸åŒçš„é›†åˆï¼Œåˆ™åˆå¹¶å®ƒä»¬ã€‚
kruskal(n, edges)ï¼š

è¿™ä¸ªå‡½æ•°å®ç°äº† Kruskal ç®—æ³•ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š
nï¼šå›¾çš„é¡¶ç‚¹æ•°ã€‚
edgesï¼šè¾¹çš„åˆ—è¡¨ï¼Œæ¯æ¡è¾¹æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ (æƒé‡, èµ·ç‚¹, ç»ˆç‚¹)ã€‚
è¯¥å‡½æ•°é¦–å…ˆå¯¹æ‰€æœ‰çš„è¾¹æŒ‰æƒé‡è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨ UnionFind æ•°æ®ç»“æ„æ¥é¿å…å½¢æˆç¯ï¼Œé€æ­¥æ„å»ºæœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰ã€‚
ä¸»ç¨‹åºï¼š

åˆ›å»ºä¸€ä¸ªå›¾ï¼Œå®šä¹‰äº†é¡¶ç‚¹æ•° n å’Œè¾¹çš„åˆ—è¡¨ edgesã€‚
è°ƒç”¨ kruskal å‡½æ•°è®¡ç®—æœ€å°ç”Ÿæˆæ ‘ï¼Œå¹¶æ‰“å°ç»“æœã€‚
'''
```

æ—¶é—´å¤æ‚åº¦ï¼š
Kruskal ç®—æ³•çš„æ€»ä½“æ—¶é—´å¤æ‚åº¦æ˜¯ O(mlogn)

### Union-find Structureså¹¶æŸ¥é›†ç»“æ„

åˆ†å‰²æˆè®¸å¤šä¸ªé›†åˆï¼ˆæœ€å¤šnä¸ªï¼‰ï¼Œæ¯ä¸ªç‚¹åªåœ¨ä¸€ä¸ªé›†åˆå½“ä¸­

åœ¨å®ç° Kruskal ç®—æ³•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŠ¨æ€åœ°è®°å½•æ¯ä¸ªé¡¶ç‚¹æ‰€å±çš„æ ‘ï¼Œä»¥ä¾¿åˆ¤æ–­æ·»åŠ ä¸€æ¡æ–°è¾¹æ˜¯å¦ä¼šå½¢æˆç¯ã€‚

æˆ‘ä»¬å°†è¿™ä¸ªé—®é¢˜å½¢å¼åŒ–ä¸º **åˆ†åŒºæ¨¡å‹**ï¼š

- å°†ä¸€ç»„é¡¶ç‚¹åˆ’åˆ†ä¸ºå¤šä¸ªç»„ã€‚
- æ¯ä¸ªé¡¶ç‚¹åªå±äºä¸€ä¸ªç»„ã€‚
- æ¯ä¸ªç»„éƒ½æœ‰ä¸€ä¸ªé¢†å¯¼è€…ï¼ˆæˆ–æ ¹èŠ‚ç‚¹ï¼‰ã€‚

å®ç°æ–¹å¼ï¼š
1ï¼ŒSequenceå®ç°
![alt text](image-6.png)
æ¯”å¦‚ï¼š4çš„ç»„åæ˜¯Aï¼›1çš„ç»„åä¹Ÿæ˜¯Aï¼Œæ‰€ä»¥4å’Œ1ä¸èƒ½åŠ 